openapi: 3.0.3
info:
  title: Library Management System API
  version: "1.0.0"
servers:
  - url: http://localhost:5000/api
components:
  securitySchemes:
    sessionCookie:
      type: apiKey
      in: cookie
      name: session
  schemas:
    Book:
      type: object
      properties:
        id: { type: integer }
        title: { type: string }
        author: { type: string }
        year: { type: integer }
        language: { type: string }
        isbn: { type: string }
        copies_total: { type: integer }
        copies_available: { type: integer }
    Loan:
      type: object
      properties:
        loan_id: { type: integer }
        book_id: { type: integer }
        user_id: { type: integer }
        checkout_date: { type: string, format: date-time }
        due_date: { type: string, format: date-time }
        return_date: { type: string, format: date-time, nullable: true }
    Error:
      type: object
      properties:
        error: { type: string }
paths:
  /books:
    get:
      summary: List books
      security:
        - sessionCookie: [ ]
      parameters:
        - in: query
          name: q
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Book"
    post:
      summary: Create a book (librarian/admin)
      security:
        - sessionCookie: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title: { type: string }
                author: { type: string }
                year: { type: integer }
                language: { type: string }
                isbn: { type: string }
                description: { type: string }
                copies_total: { type: integer }
                copies_available: { type: integer }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id: { type: integer }
        "403":
          description: Forbidden for non-librarian/admin users
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /loans/{book_id}/checkout:
    post:
      summary: Checkout a book
      security:
        - sessionCookie: [ ]
      parameters:
        - in: path
          name: book_id
          required: true
          schema: { type: integer }
      responses:
        "200": { description: OK }
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Loan"
        "400":
          description: No copies available
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /loans/{loan_id}/return:
    post:
      summary: Return a loaned book
      security:
        - sessionCookie: [ ]
      parameters:
        - in: path
          name: loan_id
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  returned: { type: boolean }
        "403":
          description: Forbidden when the loan does not belong to the user and user is not librarian/admin
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
